@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    var rol = Context.Session.GetString("Rol") ?? "";
    var username = Context.Session.GetString("Username") ?? "Invitado";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>@ViewData["Title"] SistemaCarcel</title>

    <link rel="stylesheet" href="~/adminlte/plugins/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" href="~/adminlte/css/adminlte.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/estilos.css" />
</head>
<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-light bg-white border-bottom shadow-sm">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <span class="nav-link text-dark font-weight-bold">
                        <i class="fas fa-user-circle text-success"></i> Usuario: @username
                    </span>
                </li>
                <li class="nav-item">
                    <a asp-controller="Cuenta" asp-action="Logout" class="nav-link text-danger font-weight-bold">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Sidebar -->
        <aside class="main-sidebar sidebar-dark-olive elevation-4">
            <a href="#" class="brand-link text-center">
                <span class="brand-text font-weight-bold text-white">Sistema Cárcel</span>
            </a>

            <div class="sidebar">
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" role="menu" data-accordion="false">
                        @if (rol == "administrador")
                        {
                            <li class="nav-item"><a asp-controller="Admin" asp-action="Index" class="nav-link"><i class="nav-icon fas fa-home"></i><p>Panel Admin</p></a></li>
                            <li class="nav-item"><a asp-controller="Usuarios" asp-action="Index" class="nav-link"><i class="nav-icon fas fa-user-cog"></i><p>Usuarios</p></a></li>
                            <li class="nav-item"><a asp-controller="Reclusos" asp-action="Index" class="nav-link"><i class="nav-icon fas fa-user-lock"></i><p>Reclusos</p></a></li>
                            <li class="nav-item"><a asp-controller="Personal" asp-action="Index" class="nav-link"><i class="nav-icon fas fa-users"></i><p>Personal</p></a></li>
                            <li class="nav-item has-treeview menu-open">
                                <a href="#" class="nav-link active"><i class="nav-icon fas fa-file-pdf"></i><p>Reportes<i class="right fas fa-angle-left"></i></p></a>
                                <ul class="nav nav-treeview">
                                    <li class="nav-item"><a class="nav-link" href="/Reportes/VisitasGenerales" target="_blank"><i class="far fa-file-pdf nav-icon"></i><p>Visitas Generales</p></a></li>
                                    <li class="nav-item"><a class="nav-link" href="/Reportes/VisitasDiarias" target="_blank"><i class="far fa-calendar nav-icon"></i><p>Visitas Diarias</p></a></li>
                                    <li class="nav-item"><a class="nav-link" href="/Reportes/RegistroVisitas" target="_blank"><i class="fas fa-list nav-icon"></i><p>Registro de Visitas</p></a></li>
                                    <li class="nav-item"><a class="nav-link" href="/Reportes/VisitasPorPabellon" target="_blank"><i class="fas fa-layer-group nav-icon"></i><p>Visitas por Pabellón</p></a></li>
                                    <li class="nav-item"><a class="nav-link" href="/Reportes/VisitasPorPeriodo?inicio=2024-01-01&fin=2025-12-31" target="_blank"><i class="far fa-calendar-alt nav-icon"></i><p>Visitas por Periodo</p></a></li>
                                </ul>
                            </li>
                        }
                        else if (rol == "tecnico")
                        {
                            <li class="nav-item"><a asp-controller="Tecnico" asp-action="Index" class="nav-link"><i class="nav-icon fas fa-tools"></i><p>Panel Técnico</p></a></li>
                            <li class="nav-item"><a asp-controller="Visitantes" asp-action="Index" class="nav-link"><i class="nav-icon fas fa-user-plus"></i><p>Visitantes</p></a></li>
                        }
                        else if (rol == "policia")
                        {
                            <li class="nav-item"><a asp-controller="Policia" asp-action="Index" class="nav-link"><i class="nav-icon fas fa-shield-alt"></i><p>Escáner Facial</p></a></li>
                        }
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Contenido -->
        <div class="content-wrapper p-3 animated fadeIn">
            @RenderBody()
        </div>
    </div>

    <!-- Scripts -->
    <script src="~/adminlte/plugins/jquery/jquery.min.js"></script>
    <script src="~/adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="~/adminlte/js/adminlte.min.js"></script>

    @RenderSection("Scripts", required: false)
    <!-- Toast container -->
<div id="toast-container" class="toast-top-right"></div>

<!-- Script toast -->
<script>
    function mostrarToast(mensaje, tipo = "success") {
        const toast = document.createElement("div");
        toast.className = "toast-message " + (tipo === "danger" ? "toast-danger" : "");
        toast.textContent = mensaje;
        document.getElementById("toast-container").appendChild(toast);
        setTimeout(() => toast.remove(), 4000);
    }
</script>

</body>
</html>
